Index: app/src/main/java/com/example/t_mobop_werewolf/WaitingRoomActivity.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.t_mobop_werewolf\r\n\r\nimport android.content.Context\r\nimport android.content.Intent\r\nimport androidx.appcompat.app.AppCompatActivity\r\nimport android.os.Bundle\r\nimport android.util.Log\r\nimport android.view.LayoutInflater\r\nimport android.view.View\r\nimport android.view.ViewGroup\r\nimport android.widget.*\r\nimport com.example.t_mobop_werewolf.FirebaseData.GeneralDataModel\r\nimport com.example.t_mobop_werewolf.FirebaseData.StoryState\r\nimport com.google.firebase.database.DataSnapshot\r\nimport com.google.firebase.database.DatabaseError\r\nimport com.google.firebase.database.ValueEventListener\r\nimport com.google.firebase.database.ktx.database\r\nimport com.google.firebase.ktx.Firebase\r\n\r\nclass WaitingRoomActivity : AppCompatActivity() {\r\n\r\n    var roomName = GeneralDataModel.localRoomName\r\n    val gameStartedRef = Firebase.database.reference.child(\"$roomName/GeneralData/GameStarted\")\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_waiting_room)\r\n        val roomName = findViewById<TextView>(R.id.textViewRoomName)\r\n        roomName.text = GeneralDataModel.localRoomName\r\n\r\n        // Launching the game\r\n        val launchGameButton = findViewById<Button>(R.id.buttonLaunchGame)\r\n        if (GeneralDataModel.iAmtheHost)\r\n        {\r\n            launchGameButton.visibility = View.VISIBLE\r\n            launchGameButton.setOnClickListener{\r\n                Toast.makeText(this, \"Launching the game\", Toast.LENGTH_SHORT).show()\r\n                try{\r\n                    GeneralDataModel.setupAndStartGame()\r\n                } catch (e: Exception) {\r\n                    e.printStackTrace()\r\n                    Log.d(\"WaitingRoomActivity\", \"Fun setupAndStartGame() failed\")\r\n                }\r\n                try{\r\n                    val intent = Intent(this, PlayingActivity::class.java)\r\n                    startActivity(intent)\r\n                } catch (e: Exception) {\r\n                    e.printStackTrace()\r\n                    Log.d(\"WaitingRoomActivity\", \"PlayingActivity launch failed\")\r\n                }\r\n            }\r\n        }\r\n\r\n        // List of the waiting players\r\n        val waitingListView = findViewById<ListView>(R.id.listViewRoomWaiting)\r\n        waitingListView.adapter = PlayerWaitingAdapter(this)\r\n        waitingListView.invalidateViews()\r\n\r\n        // PopUp pannel to configure game rules - not used\r\n        val fragmentWaitingRoom = Frag_WaitingRoom()\r\n        supportFragmentManager.beginTransaction().apply {\r\n            remove(fragmentWaitingRoom)\r\n            commit()\r\n        }\r\n\r\n        val buttonFloatingPointConfig = findViewById<com.google.android.material.floatingactionbutton.FloatingActionButton>(R.id.floattingPointConfig)\r\n        buttonFloatingPointConfig.setOnClickListener{\r\n            if(fragmentWaitingRoom.isVisible){\r\n                Toast.makeText(this, \"Closing: ConfigFragment\", Toast.LENGTH_SHORT).show()\r\n                supportFragmentManager.beginTransaction().apply {\r\n                    remove(fragmentWaitingRoom)\r\n                    commit() } }\r\n            else {\r\n                Toast.makeText(this, \"Launching ConfigFragment\", Toast.LENGTH_SHORT).show()\r\n                supportFragmentManager.beginTransaction().apply {\r\n                    add(R.id.FragmentConfigRoom, fragmentWaitingRoom)\r\n                    addToBackStack(null)\r\n                    commit()\r\n                }\r\n            }\r\n        }\r\n\r\n        // ---x--- Firebase database listener for the GameStarted variable ---x---\r\n        gameStartedRef.addValueEventListener(object: ValueEventListener\r\n        {\r\n            override fun onDataChange(snapshot: DataSnapshot) {\r\n                if (snapshot.exists()) {\r\n                    // works if the host has launched the game\r\n                    if (snapshot.value as Boolean && GeneralDataModel.iAmtheHost.not()){\r\n                        Log.d(\"WaitingRoomActivity\", \"GameStarted : true\")\r\n                        val intent = Intent(this@WaitingRoomActivity, PlayingActivity::class.java)\r\n                        startActivity(intent)\r\n                    }\r\n                }\r\n            }\r\n            override fun onCancelled(error: DatabaseError) {\r\n                Toast.makeText(applicationContext, \"Error database for storyState\", Toast.LENGTH_SHORT).show()\r\n            }\r\n        })\r\n\r\n    } // onCreate\r\n\r\n\r\n    // List adapter for display the players in the room\r\n    private class PlayerWaitingAdapter(context: Context): BaseAdapter() {\r\n\r\n        private val mContext: Context\r\n\r\n        private val names = GeneralDataModel.getPlayersPseudos(GeneralDataModel.localRoomName)\r\n\r\n        init{mContext = context}\r\n\r\n        override fun getCount(): Int { return names.size }\r\n\r\n        override fun getItemId(position: Int): Long { return  position.toLong() }\r\n\r\n        override fun getItem(position: Int): Any { return \"TEST STRING\" }\r\n\r\n        override fun getView(position: Int, convertView: View?, viewGroup: ViewGroup?): View {\r\n            val layoutInflater = LayoutInflater.from(mContext)\r\n            val rowMain = layoutInflater.inflate(R.layout.row_waiting_room, viewGroup, false)\r\n\r\n            val playerWaiting = rowMain.findViewById<TextView>(R.id.textViewPlayerWaiting)\r\n            playerWaiting.text = names[position] + \" is ready.\"\r\n\r\n            return rowMain\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/t_mobop_werewolf/WaitingRoomActivity.kt	(revision 72ef023f6f0517ee5bfadc975da65adbe8843880)
+++ app/src/main/java/com/example/t_mobop_werewolf/WaitingRoomActivity.kt	(date 1609624576346)
@@ -54,7 +54,6 @@
         // List of the waiting players
         val waitingListView = findViewById<ListView>(R.id.listViewRoomWaiting)
         waitingListView.adapter = PlayerWaitingAdapter(this)
-        waitingListView.invalidateViews()
 
         // PopUp pannel to configure game rules - not used
         val fragmentWaitingRoom = Frag_WaitingRoom()
Index: app/src/main/java/com/example/t_mobop_werewolf/FirebaseData/GeneralDataModel.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.t_mobop_werewolf.FirebaseData\r\n\r\nimport android.content.Intent\r\nimport android.util.Log\r\nimport androidx.core.content.ContextCompat.startActivity\r\nimport com.example.t_mobop_werewolf.PlayingActivity\r\nimport com.example.t_mobop_werewolf.PlayingHostActivity\r\nimport com.example.t_mobop_werewolf.WaitingRoomActivity\r\nimport com.google.android.material.tabs.TabLayout\r\nimport com.google.firebase.database.*\r\nimport com.google.firebase.database.ktx.database\r\nimport com.google.firebase.ktx.Firebase\r\nimport kotlinx.android.synthetic.main.activity_playing.*\r\nimport kotlinx.android.synthetic.main.activity_waiting_room.*\r\nimport java.util.*\r\n\r\n/*\r\n    This object allows to communicate with the Firebase Realtime Database.\r\n        Data is accessible in a local snapshot and is updated on any change (method onDataChange())\r\n        The Database has a listener attached to it that allows to automatically update it.\r\n\r\n\r\n    The following function are usable anywhere in the project to access a value from the\r\n    database:\r\n\r\n\r\n        GeneralDataModel.createRoom(RoomName: String, NbPlayers: Int, HostName: String ): Boolean\r\n        GeneralDataModel.joinRoom(RoomName: String, Pseudo: String): Boolean\r\n        GeneralDataModel.setupAndStartGame()\r\n        GeneralDataModel.getPlayersNumber(RoomName: String): Int\r\n        GeneralDataModel.getAnyData(Path: String): Any\r\n        GeneralDataModel.getStoryState(RoomName: String): Double\r\n        GeneralDataModel.changeStoryState(RoomName: String, NextState: Double) : Boolean\r\n        GeneralDataModel.getPlayerRole(RoomName: String, PlayerPseudo: String): String\r\n        GeneralDataModel.killPlayer(RoomName: String, PlayerPseudo: String): Boolean\r\n        GeneralDataModel.localSnapshotInit()\r\n        GeneralDataModel.setupDatabaseAsDefault()\r\n\r\n\r\n */\r\n\r\nobject GeneralDataModel: Observable()\r\n{\r\n    private var TAG = \"GeneralDataModel\"\r\n    private var database = Firebase.database.reference\r\n    private fun getDatabaseRef() : DatabaseReference? {\r\n        return FirebaseDatabase.getInstance().reference}\r\n\r\n    // Event listener attached to the database root\r\n    private var mGeneralListener: ValueEventListener? = null\r\n\r\n    // Local variables containing the database values\r\n    lateinit var localSnapshot: DataSnapshot\r\n    var localRoomName: String = \"None\"\r\n    var localPseudo: String = \"None\"\r\n    var localPlayerNb: Long = 1\r\n    var localRole: String = \"None\"\r\n    var iAmtheHost: Boolean = false\r\n\r\n    init\r\n    {\r\n        if (mGeneralListener != null) {getDatabaseRef()?.removeEventListener(mGeneralListener!!)}\r\n        mGeneralListener = null\r\n\r\n        mGeneralListener = object: ValueEventListener\r\n        {\r\n            override fun onDataChange(snapshot: DataSnapshot) {\r\n                try\r\n                {\r\n                    if (snapshot != null)\r\n                    {\r\n                        localSnapshot = snapshot\r\n                        Log.d(TAG, \"Data updated\")\r\n                        setChanged()\r\n                        notifyObservers()\r\n                    }\r\n                } catch (e: Exception) { e.printStackTrace() }\r\n            }\r\n\r\n            override fun onCancelled(error: DatabaseError) {\r\n                Log.d(TAG, \"Updated snapshot download cancelled!\")}\r\n\r\n        } // mValueDataListener\r\n        getDatabaseRef()?.addValueEventListener(mGeneralListener!!)\r\n    } // init\r\n\r\n\r\n\r\n\r\n    //                                      ---------x---------\r\n    //                                      Firebase Functions\r\n\r\n\r\n    // This function is called at the end of a turn. It will setup the next state.\r\n    fun nextState(currentState: Long): Long {\r\n        // use : nextStage(GeneralDataModel.getStoryState(), GeneralDataModel.localRoomName)\r\n\r\n        // For every step\r\n            // 1    check which is the next state (roles dead/alive)\r\n            // 2    update story for the new state\r\n            // 3    update value nextState\r\n\r\n        var nextState : Long = 0\r\n        var textToShow: String = \"Waiting\"\r\n\r\n        when(currentState) {\r\n            1.toLong() ->   // Game starts\r\n            {\r\n                // Next state 2 by default\r\n                textToShow = \"2\"\r\n                nextState = 2 // village goes to sleep\r\n            }\r\n\r\n            2.toLong() ->   // Village sleeping\r\n            {\r\n                // Next state 3 by default\r\n                textToShow = \"3\"\r\n                nextState = 3 // Werewolf will play\r\n            }\r\n\r\n            3.toLong() ->   // Werewolf have played\r\n            {\r\n                if (localSnapshot.child(\"$localRoomName/RolesData/VillagerCount\").value as Long == 0 as Long) {\r\n                    textToShow = \"9\"\r\n                    nextState = 9   // end of game, villagers are dead\r\n                } else if (localSnapshot.child(\"$localRoomName/RolesData/WitchAlive\").value as Boolean) {\r\n                    textToShow = \"4\"\r\n                    nextState = 4   // Witch will play\r\n                } else if (localSnapshot.child(\"$localRoomName/RolesData/FortuneTellerAlive\").value as Boolean) {\r\n                    textToShow = \"5\"\r\n                    nextState = 5   // FortuneTeller will play\r\n                } else {\r\n                    textToShow = \"6\"\r\n                    nextState = 6   // Village will wake up\r\n                }\r\n            }\r\n\r\n            4.toLong() ->   // Witch has played\r\n            {\r\n                if (localSnapshot.child(\"$localRoomName/RolesData/FortuneTellerAlive\").value as Boolean) {\r\n                    textToShow = \"5\"\r\n                    nextState = 5 // FortuneTeller will play\r\n                } else {\r\n                    nextState = 6 // Village will wake up\r\n                }\r\n            }\r\n\r\n            5.toLong() ->   // Fortune teller has played\r\n            {\r\n                textToShow = \"6\"\r\n                nextState = 6 // Village will wake up\r\n            }\r\n\r\n            6.toLong() ->   // Village has discovered the dead\r\n            {\r\n                textToShow = \"7\"\r\n                nextState = 7 // Village will barbecue someone\r\n            }\r\n\r\n            7.toLong() ->   // Village has sacrificed\r\n            {\r\n                textToShow = \"8\"\r\n                nextState = 8 // Village will reveal sacrifice\r\n            }\r\n\r\n            8.toLong() ->   // Village sacrifice revelation\r\n            {\r\n                if (localSnapshot.child(\"$localRoomName/RolesData/WerewolvesCount\").value as Long > 0) {\r\n                    textToShow = \"2\"\r\n                    nextState = 2   // going to sleep\r\n                } else {\r\n                    textToShow = \"9\"\r\n                    nextState = 9   // end of game, werevolves are dead\r\n                }\r\n            }\r\n\r\n            9.toLong() ->   // Game end\r\n            {\r\n                Log.d(TAG, \"The game is finished and you should not see this text.\")\r\n            }\r\n            else -> textToShow = \"You messed up something.\"\r\n        }\r\n        PlayingActivity().textview_storytelling.text = textToShow\r\n        PlayingHostActivity().textview_storytelling.text = textToShow\r\n        changeStoryState(nextState)\r\n        return nextState\r\n    }\r\n\r\n\r\n    fun createRoom(RoomName: String, NbPlayers: Int, HostName: String ): Boolean\r\n    {\r\n        Log.d(TAG, \"Fun createRoom() called\")\r\n        var roomAlreadyOpen: Boolean = false\r\n        try\r\n        {\r\n            for (item: DataSnapshot in localSnapshot.child(\"Rooms\").children){\r\n                Log.d(TAG, \"ExistingRooms: ${item.key.toString()}\")\r\n                if (item.key.toString() == RoomName) {\r\n                    Log.d(TAG, \"Room already exists\")\r\n                    roomAlreadyOpen = true\r\n                }\r\n            }\r\n            if (roomAlreadyOpen.not()){\r\n                Log.d(TAG, \"Creating new room: $RoomName\")\r\n                database.child(\"0_Rooms/$RoomName\").setValue(\"Open\")\r\n                database.child(\"$RoomName/GeneralData/GameStarted\").setValue(false)\r\n                database.child(\"$RoomName/GeneralData/HostName\").setValue(HostName)\r\n                database.child(\"$RoomName/GeneralData/MaxPlayers\").setValue(NbPlayers)\r\n                database.child(\"$RoomName/GeneralData/NbPlayers\").setValue(1)\r\n                database.child(\"$RoomName/GeneralData/RolesDistributed\").setValue(false)\r\n                database.child(\"$RoomName/GeneralData/RoomName\").setValue(RoomName)\r\n                database.child(\"$RoomName/GeneralData/StoryState\").setValue(0) //(0.0)\r\n                database.child(\"$RoomName/GeneralData/WaitingRoomOpen\").setValue(false)\r\n                database.child(\"$RoomName/GeneralData/Flag\").setValue(false)\r\n\r\n                database.child(\"$RoomName/Players/Player1/Alive\").setValue(true)\r\n                database.child(\"$RoomName/Players/Player1/Pseudo\").setValue(HostName)\r\n                database.child(\"$RoomName/Players/Player1/Role\").setValue(\"None\")\r\n                database.child(\"$RoomName/Players/Player1/Voted\").setValue(false)\r\n                database.child(\"$RoomName/Players/Player1/Votes\").setValue(0)\r\n                database.child(\"$RoomName/Players/Player1/Werewolf\").setValue(false)\r\n\r\n                database.child(\"$RoomName/RolesData/PotionKill\").setValue(1)\r\n                database.child(\"$RoomName/RolesData/PotionSave\").setValue(1)\r\n                database.child(\"$RoomName/RolesData/VillagersCount\").setValue(0)\r\n                database.child(\"$RoomName/RolesData/WerewolvesCount\").setValue(0)\r\n                database.child(\"$RoomName/RolesData/WitchAlive\").setValue(false)\r\n                database.child(\"$RoomName/RolesData/FortuneTellerAlive\").setValue(false)\r\n\r\n                localRoomName = RoomName\r\n                localPseudo = HostName\r\n                iAmtheHost = true\r\n            }\r\n        } catch (e: Exception) { e.printStackTrace() }\r\n        return roomAlreadyOpen.not()\r\n    }\r\n\r\n\r\n    fun joinRoom(RoomName: String, Pseudo: String) : Boolean{\r\n        // Add check if player already exists\r\n        // Add check for max players\r\n        Log.d(TAG, \"Fun joinRoom() called\")\r\n        var joinSuccess : Boolean = false\r\n        if (localSnapshot.child(\"0_Rooms/$RoomName\").value.toString() == \"Open\")\r\n        {\r\n            try\r\n            {\r\n                val nbPlayer = getPlayersNumber(RoomName) + 1\r\n                database.child(\"$RoomName/Players/Player$nbPlayer/Alive\").setValue(true)\r\n                database.child(\"$RoomName/Players/Player$nbPlayer/Pseudo\").setValue(Pseudo)\r\n                database.child(\"$RoomName/Players/Player$nbPlayer/Role\").setValue(\"None\")\r\n                database.child(\"$RoomName/Players/Player$nbPlayer/Voted\").setValue(false)\r\n                database.child(\"$RoomName/Players/Player$nbPlayer/Votes\").setValue(0)\r\n                database.child(\"$RoomName/Players/Player$nbPlayer/Werewolf\").setValue(false)\r\n                database.child(\"$RoomName/GeneralData/NbPlayers\").setValue(nbPlayer)\r\n                localRoomName = RoomName\r\n                localPseudo = Pseudo\r\n                iAmtheHost = false\r\n                localPlayerNb = nbPlayer\r\n                WaitingRoomActivity().listViewRoomWaiting.invalidateViews() // update players list waiting in the room\r\n                Log.d(TAG, \"Fun joinRoom() success\")\r\n                joinSuccess = true\r\n            } catch (e: Exception) {\r\n                e.printStackTrace()\r\n                Log.d(TAG, \"Fun joinRoom() failed\")\r\n                joinSuccess = false\r\n            }\r\n        } else {\r\n            Log.d(TAG, \"Room: $RoomName is closed, sorry.\")\r\n            joinSuccess = false\r\n        }\r\n        return joinSuccess\r\n    }\r\n\r\n\r\n    fun setupAndStartGame()\r\n    {\r\n        Log.d(TAG, \"Fun setupAndStartGame()\")\r\n        database.child(\"0_Rooms/$localRoomName\").setValue(\"Closed\")\r\n        try{\r\n            distributeRoles()\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n            Log.d(TAG, \"Fun setupAndStartGame()/distributeRoles() failed\")\r\n        }\r\n        database.child(\"$localRoomName/GeneralData/GameStarted\").setValue(true)\r\n        try{\r\n            changeStoryState(1)\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n            Log.d(TAG, \"Fun setupAndStartGame()/changeStoryState(1.0) failed\")\r\n        }\r\n\r\n    }\r\n\r\n    private fun distributeRoles()\r\n    {\r\n        Log.d(TAG, getPlayersNumber(localRoomName).toString())\r\n        when(getPlayersNumber(localRoomName))\r\n        {\r\n            3.toLong() ->\r\n            {\r\n                Log.d(TAG, \"fun distributeRoles(3)\")\r\n                database.child(\"$localRoomName/Players/Player1/Role\").setValue(\"Villager\")\r\n                database.child(\"$localRoomName/Players/Player2/Role\").setValue(\"Werewolf\")\r\n                database.child(\"$localRoomName/Players/Player3/Role\").setValue(\"Witch\")\r\n\r\n                database.child(\"$localRoomName/RolesData/VillagersCount\").setValue(2)\r\n                database.child(\"$localRoomName/RolesData/WerewolvesCount\").setValue(1)\r\n                database.child(\"$localRoomName/RolesData/WitchAlive\").setValue(true)\r\n                database.child(\"$localRoomName/RolesData/FortuneTellerAlive\").setValue(false)\r\n            }\r\n            4.toLong() ->\r\n            {\r\n                Log.d(TAG, \"fun distributeRoles(4)\")\r\n                database.child(\"$localRoomName/Players/Player1/Role\").setValue(\"Villager\")\r\n                database.child(\"$localRoomName/Players/Player2/Role\").setValue(\"Villager\")\r\n                database.child(\"$localRoomName/Players/Player3/Role\").setValue(\"Werewolf\")\r\n                database.child(\"$localRoomName/Players/Player4/Role\").setValue(\"Witch\")\r\n\r\n                database.child(\"$localRoomName/RolesData/VillagersCount\").setValue(3)\r\n                database.child(\"$localRoomName/RolesData/WerewolvesCount\").setValue(1)\r\n                database.child(\"$localRoomName/RolesData/WitchAlive\").setValue(true)\r\n                database.child(\"$localRoomName/RolesData/FortuneTellerAlive\").setValue(false)\r\n            }\r\n            5.toLong() ->\r\n            {\r\n                Log.d(TAG, \"fun distributeRoles(5)\")\r\n                database.child(\"$localRoomName/Players/Player1/Role\").setValue(\"Villager\")\r\n                database.child(\"$localRoomName/Players/Player2/Role\").setValue(\"Werewolf\")\r\n                database.child(\"$localRoomName/Players/Player3/Role\").setValue(\"Werewolf\")\r\n                database.child(\"$localRoomName/Players/Player4/Role\").setValue(\"Witch\")\r\n                database.child(\"$localRoomName/Players/Player5/Role\").setValue(\"FortuneTeller\")\r\n\r\n                database.child(\"$localRoomName/RolesData/VillagersCount\").setValue(3)\r\n                database.child(\"$localRoomName/RolesData/WerewolvesCount\").setValue(2)\r\n                database.child(\"$localRoomName/RolesData/WitchAlive\").setValue(true)\r\n                database.child(\"$localRoomName/RolesData/FortuneTellerAlive\").setValue(true)\r\n            }\r\n            6.toLong() ->\r\n            {\r\n                Log.d(TAG, \"fun distributeRoles(6)\")\r\n                database.child(\"$localRoomName/Players/Player1/Role\").setValue(\"Villager\")\r\n                database.child(\"$localRoomName/Players/Player2/Role\").setValue(\"Villager\")\r\n                database.child(\"$localRoomName/Players/Player3/Role\").setValue(\"Werewolf\")\r\n                database.child(\"$localRoomName/Players/Player4/Role\").setValue(\"Werewolf\")\r\n                database.child(\"$localRoomName/Players/Player5/Role\").setValue(\"Witch\")\r\n                database.child(\"$localRoomName/Players/Player6/Role\").setValue(\"FortuneTeller\")\r\n\r\n                database.child(\"$localRoomName/RolesData/VillagersCount\").setValue(4)\r\n                database.child(\"$localRoomName/RolesData/WerewolvesCount\").setValue(2)\r\n                database.child(\"$localRoomName/RolesData/WitchAlive\").setValue(true)\r\n                database.child(\"$localRoomName/RolesData/FortuneTellerAlive\").setValue(false)\r\n            }\r\n            else -> Log.d(TAG, \"fun distributeRoles(): can't assign roles to players\")\r\n        }\r\n    }\r\n\r\n    fun getPlayersNumber(RoomName: String): Long {\r\n        val value: Long\r\n        if (localSnapshot.child(\"$RoomName/GeneralData/NbPlayers\").exists()){\r\n            value = localSnapshot.child(\"$RoomName/GeneralData/NbPlayers\").value as Long\r\n        } else {\r\n            value = 1 //0(testing)\r\n        }\r\n        return value\r\n    }\r\n\r\n    fun getPlayersPseudos(RoomName: String): ArrayList<String>{\r\n        var nbPlayers = getPlayersNumber(RoomName)\r\n        var playersPseudoArray = ArrayList<String>()\r\n        for (i in 1..nbPlayers)\r\n        {\r\n            if (localSnapshot.child(\"$RoomName/Players/Player$i/Pseudo\").exists()){\r\n                playersPseudoArray.add(localSnapshot.child(\"$RoomName/Players/Player$i/Pseudo\").value as String)\r\n            } else {\r\n                Log.d(TAG, \"fun getPlayersPseudo($nbPlayers) failed\")\r\n            }\r\n\r\n        }\r\n        return playersPseudoArray\r\n    }\r\n\r\n    fun getPlayersVotes(RoomName: String): ArrayList<Int>{\r\n        var nbPlayers = getPlayersNumber(RoomName)\r\n        var playersVotesArray = ArrayList<Int>()\r\n        for (i in 1..nbPlayers) {\r\n            if (localSnapshot.child(\"$RoomName/Players/Player$i/Votes\").exists()) {\r\n                playersVotesArray.add(localSnapshot.child(\"$RoomName/Players/Player$i/Votes\").value as Int)\r\n            } else {\r\n                Log.d(TAG, \"fun getPlayersVotes() failed\")\r\n            }\r\n        }\r\n        return playersVotesArray\r\n    }\r\n\r\n    fun getPlayerRole(PlayerPseudo: String): String {\r\n        return try{\r\n            localSnapshot.child(\"$localRoomName/Players/Player$localPlayerNb/Role\").value as String\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n            Log.d(TAG, \"fun getPlayerRole failed\")\r\n            \"Failed\"\r\n        }\r\n    }\r\n\r\n    fun validateVote(RoomName: String, voteType: String  ): Boolean{\r\n        var nbPlayers = getPlayersNumber(RoomName)\r\n        var voteFlag: Boolean = true// set le flag a true\r\n        when (voteType){\r\n            \"Villager\" ->\r\n                for (i in 1..nbPlayers) // check all flags\r\n                {\r\n                    if (!(localSnapshot.child(\"$RoomName/Players/Player$i/Voted\").value as Boolean)) voteFlag = false\r\n                }\r\n            \"Werewolf\" ->\r\n                for (i in 1..nbPlayers) // check all flags\r\n                {\r\n                    if (!(localSnapshot.child(\"$RoomName/Players/Player$i/Voted\").value as Boolean)\r\n                        && localSnapshot.child(\"$RoomName/Players/Player$i/Werewolf\").value as Boolean ) voteFlag = false\r\n                }\r\n        }\r\n        return voteFlag\r\n    }\r\n\r\n    fun getAnyData(Path: String): Any {\r\n        return localSnapshot.child(Path).value as Any\r\n    }\r\n\r\n    fun setAnyData(Path: String, Value: Any): Boolean {\r\n        Log.d(TAG, \"Fun setAnyData() called\")\r\n        var success: Boolean = false\r\n        success = try{\r\n            database.child(Path).setValue(Value)\r\n            true\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n            Log.d(TAG, \"Fun setAnyData() failed\")\r\n            false\r\n        }\r\n        return success\r\n    }\r\n\r\n    fun getStoryState() : Long {\r\n        return localSnapshot.child(\"$localRoomName/GeneralData/StoryState\").value as Long\r\n    }\r\n\r\n    fun changeStoryState(NextState: Long) : Boolean {\r\n        return try{\r\n            database.child(\"$localRoomName/GeneralData/StoryState\").setValue(NextState)\r\n            true\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n            Log.d(TAG, \"fun changeStoryState failed\")\r\n            false\r\n        }\r\n    }\r\n\r\n    fun killPlayer(PlayerPseudo: String): Boolean {\r\n        // add role dependant kill count in DB\r\n        return try{\r\n            database.child(\"$localRoomName/GeneralData/Players/$PlayerPseudo/Alive\").setValue(false)\r\n            true\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n            Log.d(TAG, \"fun killPlayer failed\")\r\n            false\r\n        }\r\n    }\r\n\r\n    fun localSnapshotInit() {\r\n        FirebaseDatabase.getInstance().reference.addListenerForSingleValueEvent(\r\n            object: ValueEventListener\r\n            {\r\n                override fun onDataChange(snapshot: DataSnapshot) {\r\n                    if (snapshot.exists()){\r\n                        localSnapshot = snapshot\r\n                        Log.d(TAG, \"localSnapshot single updated at startup\")\r\n                    }\r\n                }\r\n                override fun onCancelled(error: DatabaseError) {\r\n                    Log.d(TAG, \"Fun singleRead() cancelled\")\r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    // Must be used only once !!! Otherwise will reinitialize all the game\r\n    fun resetAllDatabase(){\r\n        //database = Firebase.database.reference\r\n        database.removeValue()              // removes everything at the root\r\n        Log.d(TAG, \"Database has been cleared.\")\r\n\r\n        database.child(\"0_NbPhoneConnected\").setValue(0)\r\n        database.child(\"0_Rooms/Room0\").setValue(\"Open\")\r\n\r\n        Log.d(TAG, \"Database has been set to default.\")\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/t_mobop_werewolf/FirebaseData/GeneralDataModel.kt	(revision 72ef023f6f0517ee5bfadc975da65adbe8843880)
+++ app/src/main/java/com/example/t_mobop_werewolf/FirebaseData/GeneralDataModel.kt	(date 1609624281101)
@@ -257,9 +257,9 @@
                 localPseudo = Pseudo
                 iAmtheHost = false
                 localPlayerNb = nbPlayer
-                WaitingRoomActivity().listViewRoomWaiting.invalidateViews() // update players list waiting in the room
                 Log.d(TAG, "Fun joinRoom() success")
                 joinSuccess = true
+                //WaitingRoomActivity().listViewRoomWaiting.invalidateViews() // update players list waiting in the room
             } catch (e: Exception) {
                 e.printStackTrace()
                 Log.d(TAG, "Fun joinRoom() failed")
Index: app/src/main/res/layout/fragment_actions_witch.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".Frag_Actions_Witch\">\r\n\r\n    <TextView\r\n        android:id=\"@+id/textViewWitchRole\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"@string/witch_role\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/textViewWitchOrder\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"/>\r\n\r\n    <TextView\r\n        android:id=\"@+id/textViewWitchOrder\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"@string/witch_order\"\r\n        android:textSize=\"20sp\"\r\n        android:textAlignment=\"center\"\r\n        android:gravity=\"center\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/textViewWitchRole\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/buttonSave\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\">\r\n    </TextView>\r\n\r\n    <Button\r\n        android:id=\"@+id/buttonSave\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"@string/witch_action_button_potion1\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/buttonValidate\"\r\n        app:layout_constraintEnd_toStartOf=\"@+id/buttonKill\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/textViewWitchOrder\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/buttonKill\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"@string/witch_action_button_potion2\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/textViewWitchOrder\"\r\n        app:layout_constraintBottom_toTopOf=\"@id/buttonValidate\"\r\n        app:layout_constraintStart_toEndOf=\"@+id/buttonSave\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"/>\r\n\r\n    <Button\r\n        android:id=\"@+id/buttonValidate\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"@string/witch_action_button_pass\"\r\n        app:layout_constraintTop_toBottomOf=\"@id/buttonSave\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"/>\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/fragment_actions_witch.xml	(revision 72ef023f6f0517ee5bfadc975da65adbe8843880)
+++ app/src/main/res/layout/fragment_actions_witch.xml	(date 1609624960581)
@@ -12,10 +12,9 @@
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:text="@string/witch_role"
-        app:layout_constraintTop_toTopOf="parent"
         app:layout_constraintBottom_toTopOf="@+id/textViewWitchOrder"
-        app:layout_constraintStart_toStartOf="parent"
-        app:layout_constraintEnd_toEndOf="parent"/>
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintTop_toTopOf="parent" />
 
     <TextView
         android:id="@+id/textViewWitchOrder"
@@ -61,4 +60,16 @@
         app:layout_constraintStart_toStartOf="parent"
         app:layout_constraintEnd_toEndOf="parent"/>
 
+    <ImageView
+        android:id="@+id/imageView"
+        android:layout_width="100"
+        android:layout_height="100"
+        android:layout_marginTop="24dp"
+        android:layout_marginBottom="24dp"
+        android:src="@drawable/ic_icon_witch"
+        app:layout_constraintBottom_toTopOf="@+id/textViewWitchRole"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent" />
+
 </androidx.constraintlayout.widget.ConstraintLayout>
\ No newline at end of file
